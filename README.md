# Mallå•†åŸ(åŸºç¡€ç¯‡çš„å¼€å‘)

## é¡¹ç›®ç®€ä»‹

Mallå•†åŸé¡¹ç›®è‡´åŠ›äºæ‰“é€ ä¸€ä¸ªå®Œæ•´çš„å¤§å‹åˆ†å¸ƒå¼æ¶æ„çš„ç”µå•†å¹³å°ï¼Œé‡‡ç”¨å…ˆé˜¶æ®µæµè¡Œçš„å‰åç«¯åˆ†ç¦»æ¨¡å¼ç¼–å†™ã€‚

Mallå•†åŸæ˜¯ä¸€å¥—ç”µå•†é¡¹ç›®ï¼ŒåŒ…æ‹¬å‰å°çš„å•†åŸç³»ç»Ÿä»¥åŠåå°ç®¡ç†ç³»ç»Ÿï¼ŒåŸºäºSpringCloudã€SpringCloud Alibabaã€Mybatis-pluså®ç°ã€‚

å‰å°å•†åŸç³»ç»ŸåŒ…æ‹¬ï¼šç”¨æˆ·ç™»é™†ã€æ³¨å†Œã€å•†å“æœç´¢ã€å•†å“è¯¦æƒ…ã€è´­ç‰©è½¦ã€è®¢å•ã€ç§’æ€æ´»åŠ¨ç­‰æ¨¡å—ã€‚

åå°ç®¡ç†ç³»ç»ŸåŒ…æ‹¬ï¼šç³»ç»Ÿç®¡ç†ã€å•†å“ç³»ç»Ÿã€ä¼˜æƒ è¥é”€ã€åº“å­˜ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€ç”¨æˆ·ç³»ç»Ÿã€å†…å®¹ç®¡ç†ç­‰ä¸ƒå¤§æ¨¡å—ã€‚

## é¡¹ç›®æ¶æ„

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202205021433733.png" alt="image-20220502143323434" style="zoom:50%;" />

![image-20220502143436881](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202205021434272.png)

## æ¥å£æ–‡æ¡£

https://easydoc.net/s/78237135/ZUqEdvA4/d3EezLdO

## é¡¹ç›®æ¼”ç¤º

### å‰å°å•†åŸç³»ç»Ÿé¡¹ç›®æ¼”ç¤º

### åå°ç®¡ç†ç³»ç»Ÿé¡¹ç›®æ¼”ç¤º

## ç”µå•†é¡¹ç›®çš„åŸºç¡€

### SPUå’ŒSKU

**SPU**ï¼š`Standerd Product  Unit`ï¼ˆæ ‡å‡†åŒ–äº§å“å•å…ƒï¼‰æ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯çš„é›†åˆï¼Œè¯¥é›†åˆæè¿°äº†ä¸€ä¸ªäº§å“çš„ç‰¹æ€§ã€‚

**SKU**ï¼š`Stock keeping  Unit`ï¼ˆåº“å­˜å•ä½ï¼‰ï¼Œå³åº“å­˜è¿›å‡ºçš„è®¡é‡å•ä½ï¼Œå¯ä»¥æ˜¯ä»¶ã€ç›’ã€æ‰˜ç›˜ç­‰ä¸ºå•ä½ã€‚SKU è¿™æ˜¯å¯¹äºå¤§å‹è¿é”è¶…å¸‚DCï¼ˆé…é€ä¸­æˆï¼‰ç‰©æµç®¡ç†çš„ä¸€ä¸ªå¿…è¦çš„æ–¹æ³•ã€‚ç°åœ¨å·²ç»è¢«å¼•ç”³ä¸ºç»Ÿä¸€ç¼–å·çš„ç®€ç§°ï¼Œæ¯ä¸­äº§å“å‡å¯¹åº”æœ‰å”¯ä¸€çš„SKUå·ã€‚

ä¾‹å¦‚ï¼šiPhone XS MAXæ˜¯SPUï¼ŒIPhone XS MAX 128G é»‘è‰²æ˜¯SKU.

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204221744259.png" alt="image-20220422174404535" style="zoom:50%;" />

### è§„æ ¼å‚æ•°ã€åŸºæœ¬å‚æ•°ã€‘å’Œé”€å”®å±æ€§

æ¯ä¸ªåˆ†ç±»ä¸‹çš„å•†å“å…±äº«è§„æ ¼å‚æ•°ï¼Œä¸é”€å”®å±æ€§ã€‚

åªæ˜¯æœ‰äº›å•†å“ä¸ä¸€å®šè¦ç”¨è¿™ä¸ªåˆ†ç±»ä¸‹å…¨éƒ¨çš„å±æ€§ã€‚

- å±æ€§æ˜¯ä»¥ä¸‰çº§åˆ†ç±»ç»„ç»‡èµ·æ¥çš„
- è§„æ ¼å‚æ•°é‡æœ‰äº›æ˜¯å¯ä»¥æä¾›æ£€ç´¢çš„
- è§„æ ¼å‚æ•°ä¹Ÿæ˜¯åŸºæœ¬å±æ€§ï¼Œä»–ä»¬å…·æœ‰è‡ªå·±çš„åˆ†ç»„
- å±æ€§çš„åˆ†ç»„ä¹Ÿæ˜¯ä»¥ä¸‰çº§åˆ†ç±»ç»„ç»‡èµ·æ¥çš„
- å±æ€§åç¡®å®šçš„ï¼Œä½†æ˜¯å€¼æ˜¯æ¯ä¸€ä¸ªå•†å“ä¸åŒæ¥å†³å®šçš„

SPUæ¥å†³å®šè§„æ ¼å‚æ•°çš„å€¼ï¼ŒSKUæ¥å†³å®šé”€å”®å±æ€§çš„å€¼ã€‚

## ç¯å¢ƒæ­å»º

æœ¬åœ°ç¯å¢ƒï¼š

````bash
root@uin-virtual-machine:/# uname -a
Linux uin-virtual-machine 5.11.0-38-generic #42~20.04.1-Ubuntu SMP Tue Sep 28 16:01:15 UTC 2021 aarch64 aarch64 aarch64 GNU/Linux
root@uin-virtual-machine:/# 
````

å¢åŠ ä¸€ä¸ªå°tipï¼šé…ç½®é™æ€IPï¼Œé…äº†éƒ½è¯´å¥½ã€‚

![image-20220417225156497](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204182013911.png)

![image-20220417223147088](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204182013604.png)

Gateway ç½‘å…³åœ°å€ 10.211.55.1ã€Ifaceç½‘å¡ eth0ã€netmaskå­ç½‘æ©ç  255.255.255.0ã€å½“å‰IP 10.211.55.15

[ä¸ºUbuntu 20.04 è®¾ç½®é™æ€IPç®€æ˜æ•™ç¨‹ï¼ˆå’ŒæŠŠå¤§è±¡è£…å†°ç®±ä¸€æ ·ç®€å•ï¼‰ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com)](https://cloud.tencent.com/developer/article/1933335)

### docker

dokceråœ¨macæœ¬åœ°å®‰è£…æ˜¯å¾ˆç®€å•çš„äº‹æƒ…ï¼Œæ¯”å¦‚ç”¨homebrewã€‚

ubuntuå®‰è£…dockerã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180816948.png" alt="image-20220417144636865" style="zoom:50%;" />

[ubuntu 18.04 arm64ç‰ˆ å®‰è£…docker è¸©å‘_è¸©å‘çš„å°æ–¹çš„åšå®¢-CSDNåšå®¢_arm ubuntuå®‰è£…docker](https://blog.csdn.net/qiangrenpu8881/article/details/104863690)

åœ¨æ­¤æ„Ÿè°¢åšä¸»ï¼ï¼ã€‚

![image-20220417150136634](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180817260.png)

[ubuntuä¸­è®¾ç½®dockerä»¥åŠå®¹å™¨å¼€æœºè‡ªå¯ - ä»£ç å…ˆé”‹ç½‘ (codeleading.com)](https://www.codeleading.com/article/58746255343/)

è¿™ä¸€æ­¥å¾ˆé‡ï¼Œå¯ä»¥çœå»å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ã€‚

### dockerå®‰è£…Redisï¼ˆå¹¶å¼€å¯æŒä¹…åŒ–ï¼‰

```bash
docker pull redis
```

```bash
mkdir -p /mydata/redis/conf
touch /mydata/redis/conf/redis.conf
```

```bash
docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf -d redis redis-server /etc/redis/redis.conf
```

[ä½¿ç”¨dockerå®‰è£…rediså¹¶æŒä¹…åŒ–_é©¬å…‹å›¾å¸ƒNo1çš„åšå®¢-CSDNåšå®¢_docker redis æŒä¹…åŒ–](https://blog.csdn.net/weixin_40271376/article/details/108810375)

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180817404.png" alt="image-20220417153916157" style="zoom:50%;" />

### dockerå®‰è£…Mysql

ç”±äºæˆ‘æ˜¯Armçš„ç³»ç»Ÿæ¶æ„ï¼ŒDocker Hubä¸Šæ²¡æœ‰é€‚ç”¨äºarm64æ¶æ„çš„mysqlé•œåƒã€‚

```bash
docker pull mysql/mysql-server:latest
```

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180817695.png" alt="image-20220417134052004" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180817628.png" alt="image-20220417134449733" style="zoom:50%;" />

**åˆ›å»ºå¹¶å¯åŠ¨MySQLæœåŠ¡å®¹å™¨**

```bash
docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql/mysql-server
```

è¿™æ—¶ä½¿ç”¨å®¿ä¸»æœºè¿æ¥æ²¡æœ‰æˆæƒè®¿é—®ï¼Œéœ€è¦è¿›å…¥mysqlä¿®æ”¹mysqlè®¿é—®æƒé™ã€‚

```bash
docker exec -it mysql bash
```

```bash
mysql -u root -p 123456
```

```sql
#æˆæƒ
CREATE USER 'root'@'%' IDENTIFIED BY 'root';
GRANT ALL ON *.* TO 'root'@'%';
```

```sql
#åˆ·æ–°æƒé™

mysql> flush privileges;
```

```sql
ä¿®æ”¹rootç”¨æˆ·å¯†ç 

mysql> ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
```

```sql
#åˆ·æ–°æƒé™

mysql> flush privileges;
```

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180817262.png" alt="image-20220417135534346" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180818660.png" alt="image-20220417140901713" style="zoom:50%;" />

**Ubuntu dockerå®‰è£…Mysql**

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180818428.png" alt="image-20220417150703705" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180818231.png" alt="image-20220417150942898" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180818346.png" alt="image-20220417151127579" style="zoom:50%;" />

## é¡¹ç›®æ­å»º

### ç‰ˆæœ¬è¯´æ˜

[ç‰ˆæœ¬è¯´æ˜ Â· alibaba/spring-cloud-alibaba Wiki (github.com)](https://github.com/alibaba/spring-cloud-alibaba/wiki/ç‰ˆæœ¬è¯´æ˜)

SpringClound Alibaba ç»„ä»¶çš„ç‰ˆæœ¬ã€‚

![image-20220417180959128](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180818277.png)

SpringCloudçš„ç‰ˆæœ¬ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204180818564.png" alt="image-20220417181119503" style="zoom:50%;" />

## ä½¿ç”¨å¿«é€Ÿå¼€å‘å¹³å°renren-fast

### æ­å»ºåå°ç³»ç»Ÿ

```bash
git clone https://gitee.com/renrenio/renren-fast.git
```

### æ­å»ºåå°çš„å‰ç«¯é¡µé¢

```bash
git clone https://gitee.com/renrenio/renren-fast-vue.git
```

## å„æ¨¡å—çš„ç«¯å£è§„å®š

å•†å“æœåŠ¡   product      8081

ä»“å‚¨æœåŠ¡   ware   		8082

è®¢å•æœåŠ¡ 	order 		8083

ä¼˜æƒ åˆ¸æœåŠ¡	coupon 	8084

ä¼šå‘˜æœåŠ¡ 	member		8085

## æ­å»ºåˆ†å¸ƒå¼çš„åŸºæœ¬ç¯å¢ƒ

**æ¶æ„å›¾**

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191012364.png" alt="image-20220419101222812" style="zoom:50%;" />

## æŠ€æœ¯é€‰å‹

![image-20220419102214121](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191025754.png)

å…¶ä»–çš„ç»„ä»¶è¯¦æƒ…ï¼š[å¾®æœåŠ¡ç›¸å…³ç»„ä»¶ - BeaBrick0 - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/bearbrick0/p/15781897.html)

## ç‰ˆæœ¬é€‰æ‹©

https://github.com/alibaba/spring-cloud-alibaba

https://github.com/alibaba/spring-cloud-alibaba/blob/2021.x/README-zh.md

![image-20220419102434215](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191024255.png)

![image-20220419102450019](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191024385.png)

## ä½¿ç”¨Spring cloud Alibaba Nacosåšé…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒ

![image-20220419105411070](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191054042.png)

Nacos æ³¨å†Œä¸­å¿ƒï¼ˆæœåŠ¡å‘ç°/æ³¨å†Œï¼‰

Nacos é…ç½®ä¸­å¿ƒï¼ˆåŠ¨æ€é…ç½®ç®¡ç†ï¼‰

https://github.com/alibaba/Nacos

![image-20220419105940889](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191059158.png)

ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨Spring Cloud Eurek æ¥åšï¼Œä½†æ˜¯åæ¥åœæ­¢ç»´æŠ¤äº†ã€‚

![image-20220419111437315](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191114719.png)

### ä½¿ç”¨Nacosæ¥åšæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒ

demoé“¾æ¥ï¼šhttps://github.com/alibaba/spring-cloud-alibaba/blob/2021.x/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example/readme-zh.md

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191116846.png" alt="image-20220419111640599" style="zoom:50%;" />

1. é¦–å…ˆï¼Œä¿®æ”¹ pom.xml æ–‡ä»¶ï¼Œå¼•å…¥ Nacos Discovery Starterã€‚

   ```xml
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    </dependency>
   ```

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191120889.png" alt="image-20220419112034523" style="zoom:50%;" />

2. åœ¨åº”ç”¨çš„ /src/main/resources/application.properties é…ç½®æ–‡ä»¶ä¸­é…ç½® Nacos Server åœ°å€

ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰NacosæœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å»ä¸‹è½½ã€‚

1. é¦–å…ˆéœ€è¦è·å– Nacos Serverï¼Œæ”¯æŒç›´æ¥ä¸‹è½½å’Œæºç æ„å»ºä¸¤ç§æ–¹å¼ã€‚
    1. ç›´æ¥ä¸‹è½½ï¼š[Nacos Server ä¸‹è½½é¡µ](https://github.com/alibaba/nacos/releases)
    2. æºç æ„å»ºï¼šè¿›å…¥ Nacos [Github é¡¹ç›®é¡µé¢](https://github.com/alibaba/nacos)ï¼Œå°†ä»£ç  git clone åˆ°æœ¬åœ°è‡ªè¡Œç¼–è¯‘æ‰“åŒ…ï¼Œ[å‚è€ƒæ­¤æ–‡æ¡£](https://nacos.io/zh-cn/docs/quick-start.html)ã€‚**æ¨èä½¿ç”¨æºç æ„å»ºæ–¹å¼ä»¥è·å–æœ€æ–°ç‰ˆæœ¬**
2. å¯åŠ¨ Serverï¼Œè¿›å…¥è§£å‹åæ–‡ä»¶å¤¹æˆ–ç¼–è¯‘æ‰“åŒ…å¥½çš„æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°å¦‚ä¸‹ç›¸å¯¹æ–‡ä»¶å¤¹ nacos/binï¼Œå¹¶å¯¹ç…§æ“ä½œç³»ç»Ÿå®é™…æƒ…å†µä¹‹ä¸‹å¦‚ä¸‹å‘½ä»¤ã€‚
    1. Linux/Unix/Mac æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œå‘½ä»¤ `sh startup.sh -m standalone`
    2. Windows æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œå‘½ä»¤ `cmd startup.cmd`

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191125323.png" alt="image-20220419112512891" style="zoom:50%;" />

æ‰¾åˆ°è¿™ä¸ªç‰ˆæœ¬ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191130157.png" alt="image-20220419113041846" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191135244.png" alt="image-20220419113533620" style="zoom:50%;" />

è·³è½¬é“¾æ¥ï¼šlocalhost:8848/nacos

ç™»é™†è´¦æˆ·å’Œå¯†ç ï¼šnacos	   nacos

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191137756.png" alt="image-20220419113738109" style="zoom:50%;" />

```properties
 spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
```

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191140805.png" alt="image-20220419114055475" style="zoom:50%;" />

3. ä½¿ç”¨ `@EnableDiscoveryClient` æ³¨è§£å¼€å¯æœåŠ¡æ³¨å†Œä¸å‘ç°åŠŸèƒ½

```java
 @SpringBootApplication
 @EnableDiscoveryClient
 public class ProviderApplication {

 	public static void main(String[] args) {
 		SpringApplication.run(ProviderApplication.class, args);
 	}

 	@RestController
 	class EchoController {
 		@GetMapping(value = "/echo/{string}")
 		public String echo(@PathVariable String string) {
 				return string;
 		}
 	}
 }
```

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191143990.png" alt="image-20220419114304858" style="zoom:50%;" />

**åº”ç”¨å¯åŠ¨**

1. å¢åŠ é…ç½®ï¼Œåœ¨ nacos-discovery-provider-example é¡¹ç›®çš„ /src/main/resources/application.properties ä¸­æ·»åŠ åŸºæœ¬é…ç½®ä¿¡æ¯

   ```
    spring.application.name=service-provider
    server.port=18082
   ```

2. å¯åŠ¨åº”ç”¨ï¼Œæ”¯æŒ IDE ç›´æ¥å¯åŠ¨å’Œç¼–è¯‘æ‰“åŒ…åå¯åŠ¨ã€‚

    1. IDEç›´æ¥å¯åŠ¨ï¼šæ‰¾åˆ° nacos-discovery-provider-example é¡¹ç›®çš„ä¸»ç±» `ProviderApplication`ï¼Œæ‰§è¡Œ main æ–¹æ³•å¯åŠ¨åº”ç”¨ã€‚
    2. æ‰“åŒ…ç¼–è¯‘åå¯åŠ¨ï¼šåœ¨ nacos-discovery-provider-example é¡¹ç›®ä¸­æ‰§è¡Œ `mvn clean package` å°†å·¥ç¨‹ç¼–è¯‘æ‰“åŒ…ï¼Œç„¶åæ‰§è¡Œ `java -jar nacos-discovery-provider-example.jar`å¯åŠ¨åº”ç”¨ã€‚

![](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191148102.png)

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191241790.png" alt="image-20220419124128531" style="zoom:50%;" />



### ä½¿ç”¨Nacosåšé…ç½®ä¸­å¿ƒ

https://github.com/alibaba/spring-cloud-alibaba/blob/2021.x/spring-cloud-alibaba-examples/nacos-example/nacos-config-example/readme-zh.md

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191510568.png" alt="image-20220419150959828" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191512732.png" alt="image-20220419151236009" style="zoom:50%;" />

#### æ“ä½œæµç¨‹

1. é¦–å…ˆï¼Œä¿®æ”¹ pom.xml æ–‡ä»¶ï¼Œå¼•å…¥ Nacos Config Starterã€‚

   ```xml
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
    </dependency>
   ```

2. åœ¨åº”ç”¨çš„ `/src/main/resources/bootstrap.properties` é…ç½®æ–‡ä»¶ä¸­é…ç½® Nacos Config å…ƒæ•°æ®

   ```properties
    spring.application.name=nacos-config-example
    spring.cloud.nacos.config.server-addr=127.0.0.1:8848
   ```

3. æµ‹è¯•

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191539914.png" alt="image-20220419153938229" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191540550.png" alt="image-20220419154038784" style="zoom:50%;" />

![image-20220419153830902](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191538797.png)

**å‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘ä»¬éœ€è¦ä¿®æ”¹ name ï¼Œç°åœ¨é¡¹ç›®å·²ç»ä¸Šçº¿äº†ï¼Œæ€ä¹ˆåš**

æ˜¾ç„¶æ”¹é¡¹ç›®ä¸­çš„é…ç½®ï¼Œæ˜¯ä¸ç†æ™ºçš„ã€‚æˆ‘ä»¬åªéœ€è¦å°†æˆ‘ä»¬çš„é…ç½®äº¤ç»™é…ç½®ä¸­å¿ƒï¼Œæˆ‘ä»¬ç›´æ¥åœ¨é…ç½®ä¸­å¿ƒæ”¹é…ç½®æ–‡ä»¶

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191930491.png" alt="image-20220419193011854" style="zoom:50%;" />

æˆ‘ä»¬å¯ä»¥åœ¨Nacosçš„é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191925351.png" alt="image-20220419192233525" style="zoom: 33%;" />

**å¦‚æœé…ç½®ä¸­å¿ƒå’Œå½“å‰é¡¹çš„é…ç½®æ–‡ä»¶éƒ½é…ç½®äº†ç›¸åŒçš„é¡¹ï¼Œä¼˜å…ˆä½¿ç”¨é…ç½®ä¸­å¿ƒçš„é…ç½®ã€‚**

**å¦‚æœé…ç½®ä¸æˆåŠŸï¼Œå¯ä»¥åŠ ä¸€ä¸‹è¯†åˆ«bootStrap.propertiesçš„ä¾èµ–ã€‚**

```xml
<!--é’ˆå¯¹é…ç½®ä¸æˆåŠŸçš„ä¾èµ–-->
<dependency>
     <groupId>org.springframework.cloud</groupId>
     <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

![image-20220419192445948](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191924835.png)

æµ‹è¯•æˆåŠŸã€‚

#### æ›´å¤šçš„ç»†èŠ‚

##### å‘½åç©ºé—´

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191937464.png" alt="image-20220419193748602" style="zoom:50%;" />

ç”¨äºè¿›è¡Œç§Ÿæˆ·ç²’åº¦çš„**é…ç½®éš”ç¦»**ã€‚ä¸åŒçš„å‘½åç©ºé—´ä¸‹ï¼Œå¯ä»¥å­˜ç›¸åŒçš„ Group æˆ– Data IDçš„é…ç½®ã€‚Namespace çš„å¸¸ç”¨åœºæ™¯ä¹‹ä¸€æ˜¯ä¸åŒçš„ç¯å¢ƒçš„é…ç½®çš„åŒºåˆ†éš”ç¦»ï¼Œä¾‹å¦‚å¼€å‘æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼ˆå¦‚é…ç½®ã€æœåŠ¡ï¼‰éš”ç¦»ç­‰ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191940413.png" alt="image-20220419194007136" style="zoom:50%;" />

![image-20220419194450139](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191944536.png)

![image-20220419194541509](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191945748.png)

åˆ©ç”¨å‘½åç©ºé—´åšç¯å¢ƒéš”ç¦»ã€‚

**åŸºäºå¾®æœåŠ¡ä¹‹é—´äº’ç›¸éš”ç¦»é…ç½®ï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½åˆ›å»ºè‡ªå·±çš„å‘½åç©ºé—´ï¼ŒåªåŠ è½½è‡ªå·±çš„å‘½åç©ºé—´ã€‚**

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191948318.png" alt="image-20220419194829355" style="zoom:50%;" />

##### é…ç½®é›†

ä¸€ç»„ç›¸å…³æˆ–è€…ä¸æƒ³å…³çš„é…ç½®é¡¹çš„é›†åˆç§°ä¸ºé…ç½®é›†ã€‚æœ¬ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶é€šå¸¸å°±æ˜¯ä¸€ä¸ªé…ç½®é›†ï¼ŒåŒ…å«äº†ç³»ç»Ÿå„ä¸ªæ–¹é¢çš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé…ç½®é›†å¯èƒ½åŒ…å«äº†æ•°æ®æºã€çº¿ç¨‹æ± ã€æ—¥å¿—çº§åˆ«çš„é…ç½®é¡¹ã€‚

##### é…ç½®é›†ID

ç±»ä¼¼äºæ–‡ä»¶åã€‚

![image-20220419195323816](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191953156.png)

##### é…ç½®åˆ†ç»„

é»˜è®¤æ‰€æœ‰çš„é…ç½®é›†éƒ½å±äºï¼šDEFAULT_GROUP

æ¯”å¦‚å«åŒ11ã€618ã€åŒ12.

```properties
#æ›´æ”¹é»˜è®¤ç»„
spring.cloud.nacos.config.group=1111
```

**åœ¨æœ¬é¡¹ç›®ä¸­é‡‡ç”¨æ¯ä¸ªå¾®æœåŠ¡åˆ›å»ºè‡ªå·±çš„å‘½åç©ºé—´ï¼Œä½¿ç”¨é…ç½®åˆ†ç»„åŒºåˆ†ç¯å¢ƒï¼Œæ¯”å¦‚devã€testã€prodç¯å¢ƒ**ã€‚

**æ€ä¹ˆå»åŒæ—¶åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Ÿ**

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204192012755.png" alt="image-20220419201222925" style="zoom:50%;" />

```properties
spring.application.name=coupon
spring.cloud.nacos.config.server-addr=127.0.0.1:8848
spring.cloud.nacos.config.namespace=f00c6f6d-ccad-4762-8599-f09604d2915f
spring.cloud.nacos.config.group=prod

#---------------ç›¸å½“äºåŠ è½½äº†ä¸€ä¸ªdatasource.ymlé…ç½®æ–‡ä»¶----tart-----
spring.cloud.nacos.config.extension-configs[0].data-id=datasource.yml
#é‚£ä¸ªç»„ dev
spring.cloud.nacos.config.extension-configs[0].group=dev
#åŠ¨æ€åˆ·æ–°
spring.cloud.nacos.config.extension-configs[0].refresh=true
#---------------ç›¸å½“äºåŠ è½½äº†ä¸€ä¸ªé…ç½®æ–‡ä»¶----end-----

#---------------ç›¸å½“äºåŠ è½½äº†ä¸€ä¸ªmybatis.ymlé…ç½®æ–‡ä»¶----tart-----
spring.cloud.nacos.config.extension-configs[1].data-id=mybatis.yml
#é‚£ä¸ªç»„ dev
spring.cloud.nacos.config.extension-configs[1].group=dev
#åŠ¨æ€åˆ·æ–°
spring.cloud.nacos.config.extension-configs[1].refresh=true
#---------------ç›¸å½“äºåŠ è½½äº†ä¸€ä¸ªé…ç½®æ–‡ä»¶----end-----

#---------------ç›¸å½“äºåŠ è½½äº†ä¸€ä¸ªother.ymlé…ç½®æ–‡ä»¶----tart-----
spring.cloud.nacos.config.extension-configs[2].data-id=other.yml
#é‚£ä¸ªç»„ dev
spring.cloud.nacos.config.extension-configs[2].group=dev
#åŠ¨æ€åˆ·æ–°
spring.cloud.nacos.config.extension-configs[2].refresh=true
#---------------ç›¸å½“äºåŠ è½½äº†ä¸€ä¸ªé…ç½®æ–‡ä»¶----end-----
```

å½“ç„¶æ˜¯æ³¨é‡Šæ‰äº†ï¼Œapplication.yml ä¸­çš„é…ç½®æ–‡ä»¶ã€‚

![](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204192026244.png)

![image-20220419202723264](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204192027668.png)

![image-20220419202812563](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204192028392.png)

##### æ€»ç»“

**æˆ‘ä»¬ä»¥åç»™å¾®æœåŠ¡é…ç½®ä»»ä½•ä¿¡æ¯ï¼Œéƒ½å¯ä»¥åœ¨é…ç½®ä¸­å¿ƒå»é…ç½®ï¼Œåªéœ€è¦åœ¨ bootstrap.properties ä¸­å£°æ˜åŠ è½½é‚£äº›é…ç½®æ–‡ä»¶ã€‚**

**é…ç½®ä¸­å¿ƒæœ‰çš„ä¼˜å…ˆä½¿ç”¨é…ç½®ä¸­å¿ƒçš„ã€‚**

### å…³äºnacosçš„æ›´å¤šçš„ä¿¡æ¯

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204192033520.png" alt="image-20220419203353721" style="zoom:50%;" />

https://nacos.io/zh-cn/docs/what-is-nacos.html

## ä½¿ç”¨Spring Cloud OpenFeign ä½œè¿œç¨‹è°ƒç”¨ï¼ˆå£°æ˜å¼çš„HTTPå®¢æˆ·ç«¯ï¼‰

https://spring.io/projects/spring-cloud-openfeign

![image-20220419105505687](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191055118.png)

### ç®€ä»‹

ä¹Ÿå«ç²ªå‘ã€‚

Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ HTTP å®¢æˆ·ç«¯ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯è®©è¿œç¨‹è°ƒç”¨æ›´åŠ ç®€å•ã€‚Feign æä¾›äº† HTTPè¯·æ±‚çš„æ¨¡æ¿ï¼Œé€šè¿‡ç¼–å†™ç®€å•çš„æ¥å£å’Œæ’å…¥æ³¨è§£ï¼Œå°±å¯ä»¥å®šä¹‰å¥½ HTTP è¯·æ±‚çš„å‚æ•°ã€æ ¼å¼ã€åœ°å€ç­‰ä¿¡æ¯ã€‚

Feign æ•´åˆäº† Rilbbonï¼ˆè´Ÿè½½å‡è¡¡ï¼‰å’ŒHystrix(æœåŠ¡çƒ¯æ–­)ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¸å†éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨è¿™ä¸¤ä¸ªç»„ä»¶ã€‚

SpringCloudFeign åœ¨ Nettix Feign çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯¹ SpringMVC æ³¨è§£çš„æ”¯æŒï¼Œåœ¨å…¶å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç¶å®šã€‚ç®€åŒ–äº†SpringCloudRibbon è‡ªè¡Œå°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚

### demo

```java
@SpringBootApplication
@EnableFeignClients
public class WebApplication {

	public static void main(String[] args) {
		SpringApplication.run(WebApplication.class, args);
	}

	@FeignClient("name")
	static interface NameService {
		@RequestMapping("/")
		public String getName();
	}
}
```

### æ¡ˆä¾‹

éœ€æ±‚ï¼šmemberï¼ˆä¼šå‘˜ï¼‰æœåŠ¡å…ˆè¦è¿œç¨‹è°ƒç”¨couponï¼ˆä¼˜æƒ å·ï¼‰æœåŠ¡ã€‚

### **æµç¨‹åˆ†æ**

1. æƒ³è¦è¿œç¨‹è°ƒç”¨å…¶ä»–çš„æœåŠ¡

    1. å¼•å…¥openfeignçš„ä¾èµ–ï¼Œè®©ä»–æ‹¥æœ‰è¿œç¨‹è°ƒç”¨çš„èƒ½åŠ›

    2. ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œå‘Šè¯‰SpringCloudè¿™ä¸ªæ¥å£éœ€è¦è¿œç¨‹è°ƒç”¨è¿œç¨‹æœåŠ¡

        1. å£°æ˜çš„æ¥å£çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½æ˜¯è°ƒç”¨é‚£ä¸ªè¿œç¨‹æœåŠ¡çš„é‚£ä¸€ä¸ªè¯·æ±‚

       <img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191456281.png" alt="image-20220419145629061" style="zoom: 33%;" />

    3. å¼€å¯è¿œç¨‹è°ƒç”¨æœåŠ¡çš„åŠŸèƒ½ `@EnableFeignClients(basePackages = "com.uin.member.feign")`

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191457431.png" alt="image-20220419145716360" style="zoom: 33%;" />

### å¯åŠ¨æµ‹è¯•

ä¼šæœ‰æŠ¥é”™ï¼Œé€šè¿‡çœ‹æ§åˆ¶å°ï¼šNo Feign Client for loadBalancing defined. Did you forget to include spring-cloud-starter-loadbalancer?

![image-20220419144940810](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191458077.png)

å¯¼å…¥è¿™ä¸ªè´Ÿè½½å‡è¡¡çš„ä¾èµ–ã€‚é‡æ–°æµ‹è¯•ã€‚

![image-20220419144859227](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191449555.png)







## ä½¿ç”¨Spring Cloud Alibaba Sentinel æœåŠ¡å®¹é”™ï¼ˆé™æµã€ç†”æ–­ã€é™çº§ï¼‰

ä¹‹å‰ä½¿ç”¨çš„Spring Cloud Netflix  Hystrixæ¥åšæœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­

https://github.com/alibaba/Sentinel

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191058294.png" alt="image-20220419105741226" style="zoom:50%;" />

## ä½¿ç”¨Spring Cloud Gateway åšApIç½‘å…³ï¼ˆwebFluxç¼–ç¨‹ï¼‰

è¯¦ç»†é…ç½®ä»‹ç»ï¼šhttps://spring.io/projects/spring-cloud-gateway

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191048158.png" alt="image-20220419104848527" style="zoom:50%;" />

### æ“ä½œæµç¨‹

1. å®Œå–„å¯¹åº”çš„ç‰ˆæœ¬ä¿¡æ¯
2. è¦ä½¿ç”¨ç½‘å…³ï¼Œéœ€è¦å¼€èµ·APIç½‘å…³çš„æœåŠ¡ä¸å‘ç°ï¼Œè¿™æ ·è¯·æ±‚å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„ç½‘å…³ï¼Œç½‘å…³å¯ä»¥å‘ç°å…¶ä»–çš„æœåŠ¡ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–çš„æœåŠ¡ã€‚

https://spring.io/guides/gs/gateway/

https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/



## ä½¿ç”¨Spring Cloud Sleuth æ¥åšè°ƒç”¨é“¾çš„ç›‘æ§

https://spring.io/projects/spring-cloud-sleuth

![image-20220419105208463](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191052608.png)

## ä½¿ç”¨Spring Cloud Alibaba Seataæ¥åšåˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆ

https://github.com/seata/seata

![image-20220419105326003](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191104519.png)

![image-20220419105643264](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204191056740.png)

## ä½¿ç”¨Spring Cloud Alibaba-OSSæ¥åšæ–‡ä»¶ä¸Šä¼ 

**ä¸Šä¼ æ–¹æ¡ˆé€‰æ‹©ï¼šæœåŠ¡ç«¯ç­¾ååç›´ä¼ **

![image-20220421201402398](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204212014493.png)

ä¸Šä¼ ä¹‹å‰å…ˆæ‰¾æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œè¦ä¸€ä¸ªé˜²ä¼ªç­¾åï¼Œæ‹¿ç€é˜²ä¼ªç­¾åï¼Œå»è®¿é—®ossã€‚

[Java (aliyun.com)](https://help.aliyun.com/document_detail/32007.html)

[æœåŠ¡ç«¯ç­¾ååç›´ä¼  (aliyun.com)](https://help.aliyun.com/document_detail/31926.html)

æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åŸºäºPost Policyçš„ä½¿ç”¨è§„åˆ™åœ¨æœåŠ¡ç«¯é€šè¿‡å„ç§è¯­è¨€ä»£ç å®Œæˆç­¾åï¼Œç„¶åé€šè¿‡è¡¨å•ç›´ä¼ æ•°æ®åˆ°OSSã€‚ç”±äºæœåŠ¡ç«¯ç­¾åç›´ä¼ æ— éœ€å°†AccessKeyæš´éœ²åœ¨å‰ç«¯é¡µé¢ï¼Œç›¸æ¯”JavaScriptå®¢æˆ·ç«¯ç­¾åç›´ä¼ å…·æœ‰æ›´é«˜çš„å®‰å…¨æ€§ã€‚

![image-20220422081540921](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204220815033.png)

[Java (aliyun.com)](https://help.aliyun.com/document_detail/91868.htm?spm=a2c4g.11186623.0.0.16075d3fNC6Cvu#concept-ahk-rfz-2fb)

### åº”ç”¨æœåŠ¡å™¨æ ¸å¿ƒä»£ç è§£æ

åº”ç”¨æœåŠ¡å™¨æºç åŒ…å«äº†ç­¾åç›´ä¼ æœåŠ¡ä»¥åŠä¸Šä¼ å›è°ƒæœåŠ¡çš„å®Œæ•´ç¤ºä¾‹ä»£ç ã€‚

**æ³¨æ„** ä»¥ä¸‹ä»…æä¾›æ ¸å¿ƒä»£ç ç‰‡æ®µï¼Œå¦‚éœ€äº†è§£è¿™ä¸¤ä¸ªåŠŸèƒ½çš„å®Œæ•´å®ç°ï¼Œè¯·å‚è§[åº”ç”¨æœåŠ¡å™¨æºç ï¼ˆJavaç‰ˆæœ¬ï¼‰](https://gosspublic.alicdn.com/doc/91868/aliyun-oss-appserver-java-master.zip)ã€‚

- ç­¾åç›´ä¼ æœåŠ¡

  ç­¾åç›´ä¼ æœåŠ¡å“åº”å®¢æˆ·ç«¯å‘é€ç»™åº”ç”¨æœåŠ¡å™¨çš„GETæ¶ˆæ¯ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

  ```java
  protected void doGet(HttpServletRequest request, HttpServletResponse response)
              throws ServletException, IOException {
  
          // é˜¿é‡Œäº‘è´¦å·AccessKeyæ‹¥æœ‰æ‰€æœ‰APIçš„è®¿é—®æƒé™ï¼Œé£é™©å¾ˆé«˜ã€‚å¼ºçƒˆå»ºè®®æ‚¨åˆ›å»ºå¹¶ä½¿ç”¨RAMç”¨æˆ·è¿›è¡ŒAPIè®¿é—®æˆ–æ—¥å¸¸è¿ç»´ï¼Œè¯·ç™»å½•RAMæ§åˆ¶å°åˆ›å»ºRAMç”¨æˆ·ã€‚
         String accessId = "yourAccessKeyId";      
         String accessKey = "yourAccessKeySecret"; 
         // Endpointä»¥åä¸œ1ï¼ˆæ­å·ï¼‰ä¸ºä¾‹ï¼Œå…¶å®ƒRegionè¯·æŒ‰å®é™…æƒ…å†µå¡«å†™ã€‚
         String endpoint = "oss-cn-hangzhou.aliyuncs.com"; 
         // å¡«å†™Bucketåç§°ï¼Œä¾‹å¦‚examplebucketã€‚
         String bucket = "examplebucket"; 
         // å¡«å†™Hoståç§°ï¼Œæ ¼å¼ä¸ºhttps://bucketname.endpointã€‚                   
         String host = "https://examplebucket.oss-cn-hangzhou.aliyuncs.com"; 
         // è®¾ç½®ä¸Šä¼ å›è°ƒURLï¼Œå³å›è°ƒæœåŠ¡å™¨åœ°å€ï¼Œç”¨äºå¤„ç†åº”ç”¨æœåŠ¡å™¨ä¸OSSä¹‹é—´çš„é€šä¿¡ã€‚OSSä¼šåœ¨æ–‡ä»¶ä¸Šä¼ å®Œæˆåï¼ŒæŠŠæ–‡ä»¶ä¸Šä¼ ä¿¡æ¯é€šè¿‡æ­¤å›è°ƒURLå‘é€ç»™åº”ç”¨æœåŠ¡å™¨ã€‚
         String callbackUrl = "https://192.168.0.0:8888";
         // è®¾ç½®ä¸Šä¼ åˆ°OSSæ–‡ä»¶çš„å‰ç¼€ï¼Œå¯ç½®ç©ºæ­¤é¡¹ã€‚ç½®ç©ºåï¼Œæ–‡ä»¶å°†ä¸Šä¼ è‡³Bucketçš„æ ¹ç›®å½•ä¸‹ã€‚
         String dir = "exampledir/"; 
  
          // åˆ›å»ºOSSClientå®ä¾‹ã€‚
          OSS ossClient = new OSSClientBuilder().build(endpoint, accessId, accessKey);
          try {
              long expireTime = 30;
              long expireEndTime = System.currentTimeMillis() + expireTime * 1000;
              Date expiration = new Date(expireEndTime);
              // PostObjectè¯·æ±‚æœ€å¤§å¯æ”¯æŒçš„æ–‡ä»¶å¤§å°ä¸º5 GBï¼Œå³CONTENT_LENGTH_RANGEä¸º5*1024*1024*1024ã€‚
              PolicyConditions policyConds = new PolicyConditions();
              policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, 0, 1048576000);
              policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);
  
              String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);
              byte[] binaryData = postPolicy.getBytes("utf-8");
              String encodedPolicy = BinaryUtil.toBase64String(binaryData);
              String postSignature = ossClient.calculatePostSignature(postPolicy);
  
              Map<String, String> respMap = new LinkedHashMap<String, String>();
              respMap.put("accessid", accessId);
              respMap.put("policy", encodedPolicy);
              respMap.put("signature", postSignature);
              respMap.put("dir", dir);
              respMap.put("host", host);
              respMap.put("expire", String.valueOf(expireEndTime / 1000));
              // respMap.put("expire", formatISO8601Date(expiration));
  
              JSONObject jasonCallback = new JSONObject();
              jasonCallback.put("callbackUrl", callbackUrl);
              jasonCallback.put("callbackBody",
                      "filename=${object}&size=${size}&mimeType=${mimeType}&height=${imageInfo.height}&width=${imageInfo.width}");
              jasonCallback.put("callbackBodyType", "application/x-www-form-urlencoded");
              String base64CallbackBody = BinaryUtil.toBase64String(jasonCallback.toString().getBytes());
              respMap.put("callback", base64CallbackBody);
  
              JSONObject ja1 = JSONObject.fromObject(respMap);
              // System.out.println(ja1.toString());
              response.setHeader("Access-Control-Allow-Origin", "*");
              response.setHeader("Access-Control-Allow-Methods", "GET, POST");
              response(request, response, ja1.toString());
  
          } catch (Exception e) {
              // Assert.fail(e.getMessage());
              System.out.println(e.getMessage());
          } finally { 
              ossClient.shutdown();
          }
      }
  ```

- ä¸Šä¼ å›è°ƒæœåŠ¡

  ä¸Šä¼ å›è°ƒæœåŠ¡å“åº”OSSå‘é€ç»™åº”ç”¨æœåŠ¡å™¨çš„POSTæ¶ˆæ¯ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

  ```java
  protected boolean VerifyOSSCallbackRequest(HttpServletRequest request, String ossCallbackBody)
              throws NumberFormatException, IOException {
          boolean ret = false;
          String autorizationInput = new String(request.getHeader("Authorization"));
          String pubKeyInput = request.getHeader("x-oss-pub-key-url");
          byte[] authorization = BinaryUtil.fromBase64String(autorizationInput);
          byte[] pubKey = BinaryUtil.fromBase64String(pubKeyInput);
          String pubKeyAddr = new String(pubKey);
          if (!pubKeyAddr.startsWith("https://gosspublic.alicdn.com/")
                  && !pubKeyAddr.startsWith("https://gosspublic.alicdn.com/")) {
              System.out.println("pub key addr must be oss addrss");
              return false;
          }
          String retString = executeGet(pubKeyAddr);
          retString = retString.replace("-----BEGIN PUBLIC KEY-----", "");
          retString = retString.replace("-----END PUBLIC KEY-----", "");
          String queryString = request.getQueryString();
          String uri = request.getRequestURI();
          String decodeUri = java.net.URLDecoder.decode(uri, "UTF-8");
          String authStr = decodeUri;
          if (queryString != null && !queryString.equals("")) {
              authStr += "?" + queryString;
          }
          authStr += "\n" + ossCallbackBody;
          ret = doCheck(authStr, authorization, retString);
          return ret;
      }
  
      protected void doPost(HttpServletRequest request, HttpServletResponse response)
              throws ServletException, IOException {
          String ossCallbackBody = GetPostBody(request.getInputStream(),
                  Integer.parseInt(request.getHeader("content-length")));
          boolean ret = VerifyOSSCallbackRequest(request, ossCallbackBody);
          System.out.println("verify result : " + ret);
          // System.out.println("OSS Callback Body:" + ossCallbackBody);
          if (ret) {
              response(request, response, "{\"Status\":\"OK\"}", HttpServletResponse.SC_OK);
          } else {
              response(request, response, "{\"Status\":\"verify not ok\"}", HttpServletResponse.SC_BAD_REQUEST);
          }
      }
  ```

  å…³äºä¸Šä¼ å›è°ƒçš„APIæ¥å£è¯´æ˜ï¼Œè¯·å‚è§[Callback](https://help.aliyun.com/document_detail/31989.htm#section-btz-phx-wdb)ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204220857241.png" alt="image-20220422085720181" style="zoom:50%;" />

## ä½¿ç”¨å‰ç«¯è‡ªå®šä¹‰æ ¡éªŒå’Œåç«¯JSR303åšåŒé‡æ ¡éªŒ

å‰ç«¯è‡ªå®šä¹‰æ ¡éªŒå®ç°å¯å‚è€ƒå‰ç«¯ä»£ç ï¼Œè¿™é‡Œåªä»‹ç»åç«¯çš„æ ¡éªŒçš„å®ç°ã€‚

åç«¯æ ¡éªŒåªéœ€è¦åœ¨éœ€è¦æ ¡éªŒçš„å­—æ®µåŠ ä¸Šç›¸å…³çš„æ ¡éªŒè§„åˆ™ï¼Œå¹¶å‘Šè¯‰SpringMVCéœ€è¦æ ¡éªŒçš„å‚æ•°ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204221411635.png" alt="image-20220422141150944" style="zoom:50%;" />

åŒæ—¶å¯ä»¥è‡ªå®šä¹‰é”™è¯¯æç¤ºã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204221417288.png" alt="image-20220422141732455" style="zoom:50%;" />

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204221412951.png" alt="image-20220422141217831" style="zoom:50%;" />

## ä½¿ç”¨SpringMVCçš„@ControllerAdviceå®ç°ç»Ÿä¸€å¼‚å¸¸çš„å¤„ç†

```java
package com.uin.product.exception;

import com.uin.utils.R;
import lombok.extern.slf4j.Slf4j;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import java.util.HashMap;
import java.util.Map;

/**
 * @author wanglufei
 * @description: é›†ä¸­å¤„ç†ï¼ˆæ„ŸçŸ¥ï¼‰é”™è¯¯
 * @date 2022/4/22/2:43 PM
 */
@Slf4j
//@ControllerAdvice(basePackages = "com.uin.product.app")
//@ResponseBody
//æ•ˆæœä¸€æ ·
@RestControllerAdvice(basePackages = "com.uin.product.app")
public class UinControllerAdvice {
    @ExceptionHandler(value = MethodArgumentNotValidException.class)
    public R handlerFormNumException(MethodArgumentNotValidException e) {
        log.error("æ•°æ®æ ¡éªŒå‡ºç°é—®é¢˜ï¼š{},å¼‚å¸¸ç±»å‹ï¼š{}", e.getMessage(), e.getClass());
        BindingResult result = e.getBindingResult();
        Map<String, String> map = new HashMap<>();
        result.getFieldErrors().forEach((item) -> {
            //é”™è¯¯æ¶ˆæ¯æç¤º
            String message = item.getDefaultMessage();
            //é‚£ä¸ªå­—æ®µå‡ºç°äº†é—®é¢˜
            String field = item.getField();
            //å°†è¿™äº›é”™è¯¯çš„ä¿¡æ¯ç”¨mapè£…èµ·æ¥
            map.put(field, message);
        });
        return R.error().put("data", map);
    }

}
```

## æ­å»ºæœåŠ¡è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜

æ­¤å¤„ä¹‹æè¿°å¤§é—®é¢˜ï¼Œå°é—®é¢˜ä¸€ç™¾åº¦å°±å‡ºæ¥äº†ã€‚

### å½“ä½¿ç”¨gatewayç½‘å…³å°†åç«¯çš„è¯·æ±‚è·¯ç”±åˆ°åç«¯çš„renren-fastæœåŠ¡æ˜¯å‡ºç°å›¾ç‰‡ä¸æ˜¾ç¤º,æœåŠ¡å‡ºç°503æˆ–è€…404

åŒæ—¶é«˜ç‰ˆæœ¬çš„è¿˜éœ€è¦æ·»åŠ :

```xml
<dependency>
     <groupId>org.springframework.cloud</groupId>
     <artifactId>spring-cloud-loadbalancer</artifactId>
</dependency>
```

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204202110119.png" alt="image-20220420210741759" style="zoom:50%;" />

![image-20220420211005170](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202204202110217.png)

## æ€»ç»“

å†ç»11å¤©ï¼Œç»ˆäºå†™å®Œäº†å•†åœºçš„åŸºç¡€åˆ†å¸ƒå¼é¡¹ç›®çš„æ­å»ºå’Œç»´æŠ¤ã€‚ä¸­é€”ä¹Ÿå¥”æºƒè¿‡ã€éš¾å—è¿‡ã€æ”¾å¼ƒè¿‡ã€‚æ¯æ¬¡ç‰¹åˆ«éš¾å—çš„æ—¶å€™ï¼Œè·‘åˆ°å•æ‰€å·å·çš„å“­ä¼šå„¿ã€‚æ¯å¤©æ—©8æ™š9ï¼Œå¾…åœ¨å®éªŒå®¤ç¡¬è‚è¿™ä¸ªé¡¹ç›®ï¼Œé€ƒè¿‡å¾ˆå¤šè¯¾ï¼Œæ‰€ä»¥è¿˜åœ¨è‚çš„å…„å¼Ÿä»¬ï¼Œåˆ«æ”¾å¼ƒï¼ç›¸ä¿¡è‡ªå·±ï¼å¥½å§ï¼Ÿ

ä¸­é—´è¿˜è¦å‡ºå»æ‰¾æš‘å‡å®ä¹ ï¼Œå»é¢è¯•ã€‚ç»ˆäºåœ¨4.27å·ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªè‡ªå·±è¿˜ç®—æ˜¯æ»¡æ„çš„å…¬å¸ï¼Œç»™çš„è–ªèµ„ä¹Ÿå¯ä»¥ã€‚å…ˆå°†å°±å¹²ç€å§ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å®ä¹ ã€‚

<img src="https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202205021413377.png" alt="image-20220502141351418" style="zoom:50%;" />

è¿˜è®°å¾—åœ¨4.26çš„é¢è¯•ï¼Œé¢è¯•å®˜è¿˜é—®åˆ°æˆ‘ï¼ŒæœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨ã€‚æˆ‘åŠæ‰“é¢è¯•å®˜ï¼ï¼ï¼é¢å®Œå°±ç»™offerï¼Œä¸è¿‡å®ä¹ ç»™çš„å·¥èµ„æœ‰ç‚¹ä½ï¼Œå…¬å¸è¿˜å¯ä»¥ï¼Œåšé“¶è¡Œçš„ä¸šåŠ¡ã€‚

æ²¿é€”æ‹åˆ°çš„ã€‚

![image-20220502141512277](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202205021415801.png)

![image-20220502141606431](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202205021416887.png)

![image-20220502141627481](https://bearbrick0.oss-cn-qingdao.aliyuncs.com/images/img/202205021416914.png)

æ”¶è·å¾ˆå¤šï¼Œç‰¹åˆ«æ„Ÿè°¢é›·ä¸°é˜³è€å¸ˆã€‚æ”¶è·å¾ˆå¤šã€‚ä¸è¡Œäº†ï¼Œçœ¼æ³ªå¿«æ‰ä¸‹æ¥äº†ã€‚ğŸ˜­

åœ¨æ­¤æ€»ç»“åˆ†å¸ƒå¼åŸºç¡€ç¯‡åšäº†å“ªäº›å†…å®¹ã€‚

- åˆ†å¸ƒå¼çš„åŸºç¡€ç¯‡æ¦‚å¿µ

å¾®æœåŠ¡ã€æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€è¿œç¨‹è°ƒç”¨ã€Feignã€ç½‘å…³

- åŸºç¡€å¼€å‘

SpringBoot 2.6.3ã€SpringCloudã€Mybatis-Plusã€Vueç»„ä»¶åŒ–ã€é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨

- ç¯å¢ƒ

Ubuntu 20.0.4ã€Dockerã€Mysqlã€Redisã€é€†å‘å·¥ç¨‹&äººäººå¼€æº

- å¼€å‘è§„èŒƒ

1. æ•°æ®æ ¡éªŒJSR303ã€å…¨å±€å¼‚å¸¸å¤„ç†ã€å…¨å±€ç»Ÿä¸€è¿”å›ã€å…¨å±€è·¨åŸŸå¤„ç†
2. æšä¸¾çŠ¶æ€ã€ä¸šåŠ¡çŠ¶æ€ç ã€VOä¸TOã€POçš„åˆ’åˆ†ã€é€»è¾‘åˆ é™¤
3. Lombokï¼š@Dataã€@Slf4j

